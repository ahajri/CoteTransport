{
  "name": "email-verification",
  "version": "0.3.1",
  "description": "Verify email sign-up using MongoDB.",
  "main": "index.js",
  "scripts": {
    "format:examples": "js-beautify -r examples/**/*.js",
    "format:main": "js-beautify -r index.js",
    "format:test": "js-beautify -s 2 -r test/*.js",
    "format": "npm run format:main && npm run format:examples && npm run format:test",
    "lint:examples": "jshint --reporter=node_modules/jshint-stylish examples/**/*.js",
    "lint:main": "jshint --reporter=node_modules/jshint-stylish index.js",
    "lint:test": "jshint --reporter=node_modules/jshint-stylish test/*.js",
    "lint": "npm run lint:main && npm run lint:examples && npm run lint:test",
    "test": "mocha"
  },
  "repository": {
    "type": "git",
    "url": "https://github.com/SaintDako/node-email-verification"
  },
  "keywords": [
    "mongodb",
    "auth",
    "authentication",
    "email"
  ],
  "author": {
    "name": "Dakota St. Laurent",
    "email": "hello@saintdako.com",
    "url": "http://saintdako.com/"
  },
  "license": "ISC",
  "bugs": {
    "url": "https://github.com/SaintDako/node-email-verification/issues"
  },
  "homepage": "https://github.com/SaintDako/node-email-verification",
  "dependencies": {
    "async": "^1.4.2",
    "mongoose": "~3.8.0",
    "nodemailer": "^1.3.0",
    "nodemailer-mandrill-transport": "^0.3.0",
    "rand-token": "^0.2.1"
  },
  "devDependencies": {
    "bcryptjs": "^2.3.0",
    "body-parser": "^1.9.3",
    "chai": "*",
    "express": "^4.10.4",
    "js-beautify": "^1.5.10",
    "jshint": "^2.8.0",
    "jshint-stylish": "^2.0.1",
    "mocha": "*",
    "nodemailer-stub-transport": "^1.0.0"
  },
  "readme": "# node email verification\n[![NPM](https://nodei.co/npm/email-verification.png?downloads=true&downloadRank=true&stars=true)](https://nodei.co/npm/email-verification/)\n\nVerify user signup with Node and MongoDB!\n\nThe way this works is as follows:\n\n- temporary user is created with a randomly generated URL assigned to it and then saved to a MongoDB collection\n- email is sent to the email address the user signed up with\n- when the URL is accessed, the user's data is transferred to the real collection\n\nA temporary user document has a TTL of 24 hours by default, but this (as well as many other things) can be configured. See the options section for more details. It is also possible to resend the verification email if needed.\n\n## Installation\nvia npm:\n\n```\nnpm install email-verification\n```\n\n## Examples\nThis little guide of sorts assumes you have a directory structure like so:\n\n```\napp/\n-- userModel.js\n-- tempUserModel.js\nnode_modules/\nserver.js\n```\n\nAll of the code in this section takes place in server.js. Note that `mongoose` has to be passed as an argument when requiring the module:\n\n```javascript\nvar User = require('./app/userModel'),\n    mongoose = require('mongoose'),\n    nev = require('email-verification')(mongoose);\nmongoose.connect('mongodb://localhost/YOUR_DB');\n```\n\nBefore doing anything, make sure to configure the options (see the section below for more extensive detail on this):\n\n```javascript\nnev.configure({\n    verificationURL: 'http://myawesomewebsite.com/email-verification/${URL}',\n    persistentUserModel: User,\n    tempUserCollection: 'myawesomewebsite_tempusers',\n\n    transportOptions: {\n        service: 'Gmail',\n        auth: {\n            user: 'myawesomeemail@gmail.com',\n            pass: 'mysupersecretpassword'\n        }\n    },\n    verifyMailOptions: {\n        from: 'Do Not Reply <myawesomeemail_do_not_reply@gmail.com>',\n        subject: 'Please confirm account',\n        html: 'Click the following link to confirm your account:</p><p>${URL}</p>',\n        text: 'Please confirm your account by clicking the following link: ${URL}'\n    }\n});\n```\n\nAny options not included in the object you pass will take on the default value specified in the section below. Calling `configure` multiple times with new options will simply change the previously defined options.\n\nTo create a temporary user model, you can either generate it using a built-in function, or you can predefine it in a separate file. If you are pre-defining it, it must be IDENTICAL to the user model with an extra field for the URL; the default one is `GENERATED_VERIFYING_URL: String`. **You're just better off generating a model**.\n\n```javascript\n// configuration options go here...\n\n// generating the model, pass the User model defined earlier\nnev.generateTempUserModel(User);\n\n// using a predefined file\nvar TempUser = require('./app/tempUserModel');\nnev.configure({\n    tempUserModel: TempUser \n});\n```\n\nThen, create an instance of the User model, and then pass it as well as a custom callback to `createTempUser`, one that makes use of the function `registerTempUser` and, if you want, handles the case where the temporary user is already in the collection:\n\n```javascript\n// get the credentials from request parameters or something\nvar email = \"...\",\n    password = \"...\";\n\nvar newUser = User({\n    email: email,\n    password: password\n});\n\nnev.createTempUser(newUser, function(err, newTempUser) {\n    // some sort of error\n    if (err)\n        // handle error...\n\n    // a new user\n    if (newTempUser) {\n        nev.registerTempUser(newTempUser, function(err) {\n            if (err)\n                // handle error...    \n\n            // flash message of success\n        });\n\n    // user already exists in our temporary collection\n    } else {\n        // flash message of failure...\n    }\n});\n```\n\nAn email will be sent to the email address that the user signed up with. Note that this does not handle hashing passwords - that must be done on your own terms. To see how to do this, check the Express example.\n\nTo move a user from the temporary storage to 'persistent' storage (e.g. when they actually access the URL we sent them), we call `confirmTempUser`, which takes the URL as well as a callback with one argument (the instance of the User model, or null) as arguments. If the callback's argument is null, it is most likely because their data expired.\n\n```javascript\nvar url = '...';\nnev.confirmTempUser(url, function(err, user) {\n    if (err)\n        // handle error...\n\n    if (user)\n        // redirect to their profile\n    else\n        // redirect to sign-up\n});\n```\n\nIf you want the user to be able to request another verification email, simply call `resendVerificationEmail`, which takes the user's email address and a callback with one argument (again, whether or not the user was found) as arguments:\n\n```javascript\nvar email = '...';\nnev.resendVerificationEmail(email, function(err, userFound) {\n    if (err)\n        // handle error...\n\n    if (userFound)\n        // email has been sent\n    else\n        // flash message of failure...\n});\n```\n\nTo see a fully functioning example that uses Express as the backend, check out the [**examples section**](https://github.com/StDako/node-email-verification/tree/master/examples/express).\n\n## API\n#### `configure(options)`\nChanges the default configuration by passing an object of options; see the section below for a list of all options.\n\n#### `generateTempUserModel(UserModel)`\nGenerates a Mongoose Model for the temporary user based off of `UserModel`, the persistent user model. The temporary model is essentially a duplicate of the persistent model except that it has the field `{GENERATED_VERIFYING_URL: String}` for the randomly generated URL by default (the field name can be changed in the options). If the persistent model has the field `createdAt`, then an expiration time (`expires`) is added to it with a default value of 24 hours; otherwise, the field is created as such:\n\n```\n{\n    ...\n    createdAt: {\n        type: Date,\n        expires: 86400,\n        default: Date.now\n    }\n    ...\n}\n```\n\nNote that `createdAt` will not be transferred to persistent storage (yet?).\n\n#### `createTempUser(user, callback(err, tempuser))`\nAttempts to create an instance of a temporary user model based off of an instance of a persistent user, `user`. `tempuser` is the temporary user instance if the user doesn't exist in the temporary collection, or `null` otherwise. If there are no errors, `err` is `null`. It is most convenient to call `registerTempUser` in the \"success\" case (i.e. not `null`) of the callback.\n\nIf a temporary user model hasn't yet been defined (generated or otherwise), a TypeError will be thrown.\n\n#### `registerTempUser(tempuser, callback(err))`\nSaves the instance of the temporary user model, `tempuser`, to the temporary collection, and then sends an email to the user requesting verification. If there are no errors, `err` is `null`.\n\n#### `confirmTempUser(url, callback(err, userTransferred))`\nTransfers a temporary user (found by `url`) from the temporary collection to the persistent collection and removes the URL assigned with the user. `userTransferred` is the persistent user instance if the user has been successfully transferred (i.e. the user accessed URL before expiration) and `null` otherwise; this can be used for redirection and what not. If there are no errors, `err` is `null`.\n\n#### `resendVerificationEmail(email, callback(err, userFound))`\nResends the verification email to a user, given their email. `userFound` is `true` if the user has been found in the temporary collection (i.e. their data hasn't expired yet) and `false` otherwise. If there are no errors, `err` is `null`.\n\n\n### Options\nHere are the default options:\n\n```javascript\nvar options = {\n    verificationURL: 'http://example.com/email-verification/${URL}',\n    URLLength: 48,\n\n    // mongo-stuff\n    persistentUserModel: null,\n    tempUserModel: null,\n    tempUserCollection: 'temporary_users',\n    emailFieldName: 'email',\n    URLFieldName: 'GENERATED_VERIFYING_URL',\n    expirationTime: 86400,\n\n    // emailing options\n    transportOptions: {\n        service: 'Gmail',\n        auth: {\n            user: 'user@gmail.com',\n            pass: 'password'\n        }\n    },\n    verifyMailOptions: {\n        from: 'Do Not Reply <user@gmail.com>',\n        subject: 'Confirm your account',\n        html: '<p>Please verify your account by clicking <a href=\"${URL}\">this link</a>. If you are unable to do so, copy and ' +\n                'paste the following link into your browser:</p><p>${URL}</p>',\n        text: 'Please verify your account by clicking the following link, or by copying and pasting it into your browser: ${URL}'\n    },\n    verifySendMailCallback: function(err, info) {\n        if (err) throw err;\n        else console.log(info.response);\n    },\n    sendConfirmationEmail: true,\n    confirmMailOptions: {\n        from: 'Do Not Reply <user@gmail.com>',\n        subject: 'Successfully verified!',\n        html: '<p>Your account has been successfully verified.</p>',\n        text: 'Your account has been successfully verified.'\n    },\n    confirmSendMailCallback: function(err, info) {\n        if (err) throw err;\n        else console.log(info.response);\n    },\n}\n```\n\n- **verificationURL**: the URL for the user to click to verify their account. `${URL}` determines where the randomly generated part of the URL goes - it must be included.\n- **URLLength**: the length of the randomly-generated string.\n- **persistentUserModel**: the Mongoose Model for the persistent user.\n- **tempUserModel**: the Mongoose Model for the temporary user. you can generate the model by using `generateTempUserModel` and passing it the persistent User model you have defined, or you can define your own model in a separate file and pass it as an option in `configure` instead.\n- **tempUserCollection**: the name of the MongoDB collection for temporary users.\n- **emailFieldName**: the field name for the user's email. if the field is nested within another object(s), use dot notation to access it, e.g. `{local: {email: ...}}` would use `'local.email'`.\n- **URLFieldName**: the field name for the randomly-generated URL.\n- **expirationTime**: the amount of time that the temporary user will be kept in collection, measured in seconds.\n- **transportOptions**: the options that will be passed to `nodemailer.createTransport`.\n- **verifyMailOptions**: the options that will be passed to `nodemailer.createTransport({...}).sendMail` when sending an email for verification. you must include `${URL}` somewhere in the `html` and/or `text` fields to put the URL in these strings.\n- **verifySendMailCallback**: the callback function that will be passed to `nodemailer.createTransport({...}).sendMail` when sending an email for verification.\n- **sendConfirmationEmail**: send an email upon the user verifiying their account to notify them of verification.\n- **confirmMailOptions**: the options that will be passed to `nodemailer.createTransport({...}).sendMail` when sending an email to notify the user that their account has been verified. you must include `${URL}` somewhere in the `html` and/or `text` fields to put the URL in these strings.\n- **confirmSendMailCallback**: the callback function that will be passed to `nodemailer.createTransport({...}).sendMail` when sending an email to notify the user that their account has been verified.\n\n### Developer-Related Stuff\nTo beautify the code:\n\n```\nnpm run format:main\nnpm run format:examples\nnpm run format:test\nnpm run format  # runs all\n```\n\nTo lint the code (will error if there are any warnings):\n\n```\nnpm run lint:main\nnpm run lint:examples\nnpm run lint:test\nnpm run lint  # runs all\n```\n\nTo test:\n\n```\nnpm test\n```\n\n### TODO\n- **development**: add a task runner WE NEED TESTS\n- **development**: throw more errors\n- *nice to have*: working examples with Sails and HapiJS (maybe Koa and Total as well?)\n\n### Acknowledgements\nthanks to [Frank Cash](https://github.com/frankcash) for looking over my code.\n\n### license\nISC\n",
  "readmeFilename": "README.md",
  "_id": "email-verification@0.3.1",
  "_shasum": "6067aeb9e50ca3faabdc2f5dcb4f85966d3d074b",
  "_from": "email-verification@",
  "_resolved": "https://registry.npmjs.org/email-verification/-/email-verification-0.3.1.tgz"
}
